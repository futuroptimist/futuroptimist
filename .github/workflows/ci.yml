name: youtube-mcp-ci

on:
  push:
    branches: ["main", "codex/**"]
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v4
        with:
          python-version: "3.11"
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install .[dev]
      - name: Ruff
        run: ruff check
      - name: Mypy
        run: mypy tools/youtube_mcp
      - name: Pytest
        run: pytest --cov=tools/youtube_mcp --cov-report=xml --cov-report=term
      - name: Coverage summary
        run: |
          python - <<'PY'
          import xml.etree.ElementTree as ET
          tree = ET.parse('coverage.xml')
          rate = float(tree.getroot().attrib['line-rate']) * 100
          with open('coverage-summary.md', 'w', encoding='utf-8') as fh:
              fh.write(f"Total coverage: {rate:.2f}%\n")
          PY
          cat coverage-summary.md >> "$GITHUB_STEP_SUMMARY"
